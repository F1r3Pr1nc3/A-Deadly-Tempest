# ##################
# Ship Sizes
# ##################
tech_nanite_ships = {
	cost = @tier5cost2
	area = engineering
	tier = 5
	category = { voidcraft }
	prerequisites = { "tech_battleships" }
	weight = @tier5weight1
	is_reverse_engineerable = yes
	is_rare = yes
	gateway = nanites #ship
	## unlock nanite ships
	prereqfor_desc = {
		ship = {
			title = "TECH_UNLOCK_NANITE_SHIP_CONSTRUCTION_TITLE"
			desc = "TECH_UNLOCK_NANITE_SHIP_CONSTRUCTION_DESC"
		}
	}
	potential = {
		has_distar = yes
		has_global_flag = l_cluster_opened
		has_resource = {
			type = nanites
			amount > 0
		}
		NOT = { has_global_flag = ESC_weapons_nanite_forbidden }
		OR = {
			NOT = { has_global_flag = distar_overhaul_mod_active }
			has_technology = tech_nanites_assembler_factory
		}
	}
	weight_modifier = {
		modifier = {
			factor = 0
			# NOT = { any_planet_within_border = { has_resource = { type = nanites amount > 0 } } }
			has_monthly_income = { resource = nanites value < 1 }
			resource_stockpile_compare = { resource = nanites value < 300 }
		}
	}
}

# ##################
# Nanite upgrades
# ##################
tech_nanite_build_speed = {
	cost = @tier5cost2
	area = engineering
	tier = 5
	category = { voidcraft }
	weight = @tier5weight2
	is_rare = yes
	potential = {
		has_global_flag = l_cluster_opened
		has_resource = {
			type = nanites
			amount > 0
		}
		OR = {
			NOT = { has_global_flag = distar_overhaul_mod_active }
			has_technology = tech_nanite_clouds
		}
	}
	modifier = {
		starbase_shipyard_build_speed_mult = 0.2
		starbase_shipyard_build_cost_mult = -0.1
	}
	weight_modifier = {
		modifier = {
			factor = 0
			# NOT = { any_planet_within_border = { has_resource = { type = nanites amount > 0 } } }
			has_monthly_income = { resource = nanites value < 1 }
			resource_stockpile_compare = { resource = nanites value < 300 }
		}
	}
}

tech_nanite_hull = {
	cost = @tier5cost3
	area = engineering
	tier = 5
	category = { voidcraft }
	ai_update_type = military
	prerequisites = { "tech_nanite_ships" }
	weight = @tier5weight3
	is_reverse_engineerable = yes
	is_rare = yes
	potential = {
		has_global_flag = l_cluster_opened
		has_resource = {
			type = nanites
			amount > 0
		}
		NOT = { has_global_flag = ESC_weapons_nanite_forbidden }
		OR = {
			NOT = { has_global_flag = distar_overhaul_mod_active }
			has_technology = tech_orbital_nanite_shipyard
		}
	}
	modifier = {
		ship_hull_mult = 0.2
		ship_armor_mult = 0.2
		ship_hull_regen_add_static = 0.5
		ship_armor_regen_add_static = 1
	}
	weight_modifier = {
		modifier = {
			factor = 0
			# NOT = { any_planet_within_border = { has_resource = { type = nanites amount > 0 } } }
			has_monthly_income = { resource = nanites value < 1 }
			resource_stockpile_compare = { resource = nanites value < 300 }
		}
	}
}

# Nanite Living Metal
tech_nanite_living_metal = {
	cost = @tier5cost1
	area = engineering
	tier = 5
	category = { materials }
	prerequisites = { "tech_mine_living_metal" }
	weight = @tier5weight1
	is_rare = yes
	# Unlocks nanite_living_metal_forge
	potential = {
		has_global_flag = l_cluster_opened
		has_resource = {
			type = nanites
			amount > 0
		}
		OR = {
			NOT = { has_global_flag = distar_overhaul_mod_active }
			has_technology = tech_nanite_clouds
		}
	}
	prereqfor_desc = {
		hide_prereq_for_desc = custom
		component = {
			title = "TECH_UNLOCK_NANITE_HULL_2_TITLE"
			desc = "TECH_UNLOCK_NANITE_HULL_2_DESC"
		}
		custom = {
			title = "tech_nanite_mega_construction"
			desc = "tech_nanite_mega_construction_desc"
		}
		# custom = {
		# 	title = "building_machinedlc_nanite_living_metal_forge"
		# 	desc = "mod_country_resource_max_sr_living_metal_add"
		# }
	}
	# add Living Metal
	modifier = {
		country_resource_max_sr_living_metal_add = 2000
	}
	weight_modifier = {
		modifier = {
			factor = 0
			# NOT = { any_planet_within_border = { has_resource = { type = nanites amount > 0 } } }
			has_monthly_income = { resource = nanites value < 1 }
			resource_stockpile_compare = { resource = nanites value < 300 }
		}
	}
}

tech_nanocrystals = {
	cost = @tier5cost1
	area = engineering
	tier = 5
	category = { materials }
	weight = @tier5weight1
	is_rare = yes
	potential = {
		has_global_flag = l_cluster_opened
		has_resource = {
			type = nanites
			amount > 0
		}
		OR = {
			NOT = { has_global_flag = distar_overhaul_mod_active }
			has_technology = tech_nanite_clouds
		}
	}
	modifier = {
		weapon_type_explosive_weapon_damage_mult = 0.2
		weapon_type_kinetic_weapon_damage_mult = 0.2
		weapon_type_energy_weapon_damage_mult = 0.2
	}
	weight_modifier = {
		modifier = {
			factor = 0
			# NOT = { any_planet_within_border = { has_resource = { type = nanites amount > 0 } } }
			has_monthly_income = { resource = nanites value < 1 }
			resource_stockpile_compare = { resource = nanites value < 300 }
		}
	}
}

# ##################################
# Nanite Starbases/stations upgrades
# ##################################
# tech_space_defense_station_4
tech_nanite_bulwark = {
	cost = @tier4cost3
	area = engineering
	icon = tech_nanite_starbase
	tier = 4
	category = { voidcraft }
	ai_update_type = all
	prerequisites = { "tech_space_defense_station_improvement" "tech_nanite_strike_craft" } # "tech_space_defense_station_1" "tech_starbase_4"
	is_rare = yes
	weight = @tier4weight2

	potential = {
		has_global_flag = l_cluster_opened
		has_resource = { type = nanites amount > 3 }
		OR = {
			NOT = { has_global_flag = distar_overhaul_mod_active }
			has_technology = tech_nanite_clouds
		}
	}
	modifier = {
		starbase_defense_platform_capacity_add = 12
	}

	prereqfor_desc = {
		ship = {
			title = "TECH_UNLOCK_NANITE_BULWARK_TITLE"
			desc = "TECH_UNLOCK_NANITE_BULWARK_DESC"
		}
	}
	## TODO
	weight_modifier = {
		factor = 0.1
		modifier = {
			factor = 10
			any_neighbor_country = {
				OR = {
					has_technology = tech_nanite_bulwark
					has_technology = tech_starbase_5
				}
			}
		}
		modifier = {
			factor = 1.25
			research_leader = {
				area = engineering
				has_trait = "leader_trait_expertise_voidcraft"
			}
		}
	}

	ai_weight = {
		# factor = 10
		modifier = {
			factor = 1.5
			research_leader = {
				area = engineering
				has_trait = "leader_trait_expertise_voidcraft"
			}
		}
	}
}

# Modular Engineering
tech_nanite_modular_engineering = {
	cost = @tier5cost3
	area = engineering
	category = { voidcraft }
	tier = 5
	prerequisites = {
		"tech_starbase_5"
		"tech_modular_engineering"
	}
	is_rare = yes
	weight = @tier5weight2
	potential = {
		has_global_flag = l_cluster_opened
		has_resource = { type = nanites amount > 0 }
		OR = {
			NOT = { has_global_flag = distar_overhaul_mod_active }
			has_technology = tech_nanite_clouds
		}
	}
	modifier = {
		starbase_building_build_speed_mult = 0.25
		starbase_module_build_speed_mult = 0.25
		starbase_upgrade_cost_mult = -0.15
		starbase_upgrade_speed_mult = 0.25
	}
	weight_modifier = {
		modifier = {
			factor = 0
			# NOT = { any_planet_within_border = { has_resource = { type = nanites amount > 0 } } }
			has_monthly_income = { resource = nanites value < 1 }
			resource_stockpile_compare = { resource = nanites value < 300 }
		}
	}
}

tech_nanite_armor = {
	cost = @tier4cost3
	area = engineering
	tier = 4
	category = { materials }
	weight = @tier4weight3
	is_rare = yes
	prerequisites = { "tech_ship_armor_5" }

	potential = {
		has_distar = yes
	}

	weight_modifier = {
		factor = 0.50
		modifier = {
			factor = 0
			# NOT = { any_planet_within_border = { has_resource = { type = nanites amount > 0 } } }
			has_monthly_income = { resource = nanites value < 1 }
			resource_stockpile_compare = { resource = nanites value < 300 }
		}
		modifier = {
			factor = @ap_technological_ascendancy_rare_tech
			has_ascension_perk = ap_technological_ascendancy
		}
		modifier = {
			factor = 1.25
			research_leader = {
				area = engineering
				has_trait = "leader_trait_expertise_materials"
			}
		}
	}

	ai_weight = {
		factor = 5
		modifier = {
			factor = 1.25
			research_leader = {
				area = engineering
				has_trait = "leader_trait_expertise_materials"
			}
		}
	}
}

#Auto-Repair Module
# tech_nanite_repair_system = {
# 	area = engineering
# 	cost = @tier5cost3
# 	tier = 5
# 	is_rare = yes
# 	category = { voidcraft }
# 	ai_update_type = military
# 	weight = @tier5weight3
# 	potential = { # 		has_resource = { type = sr_living_metal amount > 0 }
# 	}
# 	weight_modifier = {
# 		factor = 0 		# Can only be reverse engineered from killing the Scavenger Bot
# 	}
# }
